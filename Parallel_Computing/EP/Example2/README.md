# Parallel Processing Educational Exercise: Serial Sum Calculator

## Introduction

Welcome to the Parallel Processing Educational Exercise! In this tutorial, we will explore the concept of calculating the sum of integers from 1 to N using a serial approach in Python. This exercise is designed to provide a hands-on learning experience for beginners in parallel processing and introduce them to job scheduling using Slurm.

## Learning Objectives

By the end of this exercise, you will be able to:

1. Understand the basic concept of serial sum calculation.
2. Implement a Python script to calculate the sum of integers from 1 to N using a serial approach.
3. Submit batch jobs using Slurm and utilize job arrays.
4. Execute Python scripts in a Slurm cluster environment.
5. Redirect the output of Slurm tasks to separate files.

## Prerequisites

Before diving into this exercise, make sure you have the following:

- Basic knowledge of Python programming.
- Access to a Slurm cluster environment.
- Python version 3.10.13 or a compatible version installed on your system.

## Exercise Files

This exercise includes the following files:

- `serial_sum.py`: The Python script that calculates the sum of integers from 1 to N using a serial approach.
- `run.sbatch`: The Slurm batch job submission script that executes the `serial_sum.py` script using Slurm's job array feature.
- `output_300.out`, `output_200.out`, `output_100.out`: Sample output files generated by the Slurm job array tasks, containing the results of the sum calculations.

## Step-by-Step Guide

Let's walk through the exercise step by step to gain a deeper understanding of serial sum calculation and job scheduling with Slurm.

### Step 1: Understanding Serial Sum Calculation

Before we dive into the code, let's understand what we mean by "serial sum calculation." Suppose we want to calculate the sum of integers from 1 to N, where N is a given positive integer. In a serial approach, we iterate through the numbers from 1 to N and add them up one by one.

For example, if N = 5, the serial sum calculation would be:
```
1 + 2 + 3 + 4 + 5 = 15
```

The formula for the sum of integers from 1 to N is:
```
sum = (N * (N + 1)) / 2
```

Using this formula, we can calculate the sum without actually iterating through all the numbers.

### Step 2: Implementing the Serial Sum Calculator in Python

Now, let's take a look at the `serial_sum.py` script:

```python
def serial_sum(x):
    k = 0
    s = 0
    while k < x:
        k = k + 1
        s = s + k
    return s
```

The `serial_sum` function takes an integer `x` as input and calculates the sum of integers from 1 to `x` using a while loop. It initializes two variables: `k` as the current number and `s` as the running sum. The loop continues until `k` reaches `x`, adding each number to the sum.

In the `main` function:

```python
def main():
    N = int(os.environ['SLURM_ARRAY_TASK_ID'])
    res = serial_sum(N)
    print( "The sum of integers from 1 through {0:d} is {1:d}.".format(N, res) )
```

We retrieve the value of N from the `SLURM_ARRAY_TASK_ID` environment variable. This variable is automatically set by Slurm when using job arrays (we'll discuss job arrays in the next step). We then call the `serial_sum` function with N and print the result.

### Step 3: Submitting Jobs with Slurm

Slurm is a job scheduling system used in cluster environments. It allows us to submit batch jobs and efficiently utilize the available resources. In this exercise, we will use Slurm to run the `serial_sum.py` script for different values of N.

Take a look at the `run.sbatch` script:

```bash
#!/bin/bash
#SBATCH -J array_test
#SBATCH -p test
#SBATCH -c 1
#SBATCH -t 00:20:00
#SBATCH --mem=4G
#SBATCH -o %A-%a.o
#SBATCH -e %A-%a.e
#SBATCH --array=100,200,300

module load python/3.10.13-fasrc01

srun -c 1 python serial_sum.py > output_${SLURM_ARRAY_TASK_ID}.out
```

This script contains Slurm directives that specify the job requirements, such as the job name (`-J`), partition (`-p`), number of CPUs (`-c`), time limit (`-t`), memory (`--mem`), and output/error file paths (`-o` and `-e`).

The `--array` directive is used to define a job array. In this case, we specify three values: 100, 200, and 300. This means that Slurm will create three separate tasks, each with a different value assigned to the `SLURM_ARRAY_TASK_ID` environment variable.

The `module load` command is used to load the required Python environment.

Finally, the `srun` command is used to execute the `serial_sum.py` script for each task. The output of each task is redirected to a separate file named `output_${SLURM_ARRAY_TASK_ID}.out`.

To submit the job, use the following command:

```
sbatch run.sbatch
```

### Step 4: Analyzing the Output

After the job completes, you will find three output files: `output_300.out`, `output_200.out`, and `output_100.out`. Each file contains the result of the serial sum calculation for the corresponding value of N.

For example, `output_300.out` will contain:

```
The sum of integers from 1 through 300 is 45150.
```

You can verify the results using the formula mentioned earlier:

```
sum = (N * (N + 1)) / 2
```

For N = 300, the sum is (300 * 301) / 2 = 45150, which matches the output.

## Conclusion

In this tutorial, we explored the concept of serial sum calculation using Python and learned how to submit batch jobs using Slurm.

By implementing the `serial_sum.py` script, you gained hands-on experience in calculating the sum of integers from 1 to N using a serial approach. You also learned how to utilize Slurm's job array feature to run the script for different values of N concurrently.
